#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"
log_file="${PRE_PUSH_LOG_FILE:-}"

if [[ "${APPS_SCRIPT_PUSH_ON_PUSH:-1}" == "0" ]]; then
  exit 0
fi

if [[ -n "${log_file}" ]]; then
  printf '%s %s\n' "$(date +'%Y-%m-%d %H:%M:%S')" \
    "pre-push: running apps-script push" >> "${log_file}"
fi

"${repo_root}/apps-script/push_drive_trigger.sh"

if [[ -n "${log_file}" ]]; then
  printf '%s %s\n' "$(date +'%Y-%m-%d %H:%M:%S')" \
    "pre-push: apps-script push completed" >> "${log_file}"
fi
