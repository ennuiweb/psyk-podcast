<!doctype html>
<html lang="da" data-design-system="{{ active_design_system_key|default:'paper-studio' }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}freudd{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=IBM+Plex+Mono:wght@500;600&family=Instrument+Sans:wght@400;500;600;700&family=Manrope:wght@400;500;600;700&family=Public+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&family=Syne:wght@600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --space-1: 4px;
        --space-2: 8px;
        --space-3: 12px;
        --space-4: 16px;
        --space-5: 24px;
        --space-6: 32px;
        --radius-sm: 10px;
        --radius-sub: 12px;
        --radius-md: 14px;
        --radius-lg: 18px;
        --radius-xl: 22px;
        --radius-pill: 999px;
        --radius-nav: 8px;
        --control-min-height: 44px;
        --font-body: "Manrope", "Avenir Next", "Helvetica Neue", sans-serif;
        --font-display: "Space Grotesk", "Manrope", sans-serif;
        --font-mono: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        --bg: #edf3fb;
        --bg-soft: #f8faff;
        --surface: #ffffff;
        --surface-soft: #f4f7ff;
        --surface-strong: #e9efff;
        --ink: #1a2743;
        --muted: #607194;
        --accent: #2f67e8;
        --accent-strong: #224fbd;
        --accent-soft: #e4edff;
        --accent-ink: #ffffff;
        --danger: #b23b4f;
        --success: #1f8f4e;
        --warn-bg: #fff4de;
        --warn-border: #f1c26b;
        --warn-ink: #714b12;
        --border: #d3ddf0;
        --border-strong: #b8c7e7;
        --surface-alt: #f7faff;
        --surface-elevated: #fbfdff;
        --text-subtle: #52688f;
        --text-subtle-2: #41547c;
        --text-strong: #1f376d;
        --table-head-bg: #f0f4ff;
        --table-head-ink: #45577b;
        --info-bg: #eef4ff;
        --info-bg-strong: #dfe9ff;
        --info-ink: #2456c6;
        --info-ink-strong: #1e47ad;
        --success-bg: #eef9f1;
        --success-bg-strong: #e7f7ef;
        --success-ink: #1f8f4e;
        --danger-bg: #fff1f4;
        --danger-bg-soft: #fff4f6;
        --danger-ink: #9f3146;
        --warn-bg-soft: #fcf8eb;
        --warn-ink-soft: #7f5f18;
        --progress-track-bg: #e7edf9;
        --progress-track-border: #d7e0f2;
        --progress-accent-start: #2f67e8;
        --progress-accent-end: #4f84ef;
        --progress-success-start: #1f8f4e;
        --progress-success-end: #39b968;
        --timeline-connector: #d5e0f4;
        --timeline-connector-done: #7da0e5;
        --placeholder-ink: #8ca0c3;
        --input-hover-border: #8ca8dc;
        --header-bg: rgba(248, 251, 255, 0.9);
        --header-brand: #1b2b4e;
        --header-brand-hover: #224fbd;
        --body-grid-color: rgba(64, 99, 169, 0.045);
        --bg-layer-1: radial-gradient(circle at 8% -10%, rgba(72, 123, 235, 0.18), transparent 38%);
        --bg-layer-2: radial-gradient(circle at 92% 0%, rgba(54, 145, 240, 0.12), transparent 42%);
        --bg-layer-3: linear-gradient(160deg, #f4f7ff 0%, #edf3fb 45%, #e8eff9 100%);
        --card-grad-a: rgba(255, 255, 255, 0.98);
        --card-grad-b: rgba(246, 250, 255, 0.98);
        --message-bg: rgba(247, 250, 255, 0.95);
        --message-ink: #3d4e71;
        --ghost-bg: #f7f9ff;
        --ghost-ink: #3f5687;
        --button-grad-start: var(--accent);
        --button-grad-end: #4a7bf0;
        --button-grad-hover-start: #3d73ef;
        --button-grad-hover-end: #5d8af2;
        --button-hover-ink: #ffffff;
        --shadow-container: 0 8px 20px rgba(48, 74, 134, 0.1);
        --shadow-hover-subtle: 0 2px 8px rgba(49, 88, 169, 0.12);
        --focus-ring: rgba(47, 103, 232, 0.28);
        color-scheme: light;
      }

      :root[data-design-system="night-lab"] {
        --font-body: "Instrument Sans", "Public Sans", sans-serif;
        --font-display: "Syne", "Instrument Sans", sans-serif;
        --bg: #0a0f1d;
        --bg-soft: #10182f;
        --surface: #141f39;
        --surface-soft: #1a2746;
        --surface-strong: #213158;
        --surface-alt: #17213d;
        --surface-elevated: #1e2d52;
        --ink: #e8eefc;
        --muted: #9aabcf;
        --text-subtle: #a6b6d8;
        --text-subtle-2: #bfcae4;
        --text-strong: #f2f6ff;
        --accent: #1de2b6;
        --accent-strong: #0fbf97;
        --accent-soft: #163d3b;
        --accent-ink: #041c17;
        --info-bg: #193459;
        --info-bg-strong: #21497d;
        --info-ink: #8ac5ff;
        --info-ink-strong: #b5d9ff;
        --success: #4dd36f;
        --success-ink: #88f0a0;
        --success-bg: #1c3b2a;
        --success-bg-strong: #265636;
        --danger: #ff627e;
        --danger-ink: #ff9bb0;
        --danger-bg: #3f1f2b;
        --danger-bg-soft: #4a2431;
        --warn-bg: #3d2e1a;
        --warn-border: #8d6a2e;
        --warn-ink: #ffd492;
        --warn-bg-soft: #3d2e1a;
        --warn-ink-soft: #ffd492;
        --border: #2a3c68;
        --border-strong: #355083;
        --table-head-bg: #1b2848;
        --table-head-ink: #b8c8ed;
        --progress-track-bg: #24324f;
        --progress-track-border: #38507d;
        --progress-accent-start: #1de2b6;
        --progress-accent-end: #18bf9b;
        --progress-success-start: #4dd36f;
        --progress-success-end: #2fb157;
        --timeline-connector: #2a3f67;
        --timeline-connector-done: #2f7a56;
        --placeholder-ink: #8ea0ca;
        --input-hover-border: #4567a1;
        --header-bg: rgba(10, 16, 32, 0.86);
        --header-brand: #ecf3ff;
        --header-brand-hover: #cfe2ff;
        --body-grid-color: rgba(154, 171, 207, 0.06);
        --bg-layer-1: radial-gradient(1200px 600px at 12% -10%, rgba(29, 226, 182, 0.12), transparent 55%);
        --bg-layer-2: radial-gradient(900px 420px at 90% 0%, rgba(255, 159, 28, 0.11), transparent 60%);
        --bg-layer-3: linear-gradient(160deg, #0a0f1d 0%, #0d1426 45%, #101a31 100%);
        --card-grad-a: rgba(27, 40, 72, 0.98);
        --card-grad-b: rgba(18, 29, 54, 0.98);
        --message-bg: rgba(28, 40, 72, 0.95);
        --message-ink: #d1dcf3;
        --ghost-bg: #1a2848;
        --ghost-ink: #cad8f5;
        --button-grad-start: #1de2b6;
        --button-grad-end: #18bf9b;
        --button-grad-hover-start: #2ce9c0;
        --button-grad-hover-end: #1cc7a2;
        --button-hover-ink: #032821;
        --shadow-container: 0 10px 28px rgba(4, 8, 20, 0.38);
        --shadow-hover-subtle: 0 4px 12px rgba(12, 28, 60, 0.35);
        --focus-ring: rgba(29, 226, 182, 0.34);
        color-scheme: dark;
      }

      :root[data-design-system="paper-studio"] {
        --font-body: "Public Sans", "Manrope", sans-serif;
        --font-display: "Fraunces", "Public Sans", serif;
        --bg: #f4efe4;
        --bg-soft: #efe7d7;
        --surface: #fffdf7;
        --surface-soft: #f8f2e6;
        --surface-strong: #efe3cc;
        --surface-alt: #faf5eb;
        --surface-elevated: #fff8ee;
        --ink: #201d18;
        --muted: #625a4f;
        --text-subtle: #71675a;
        --text-subtle-2: #5f5549;
        --text-strong: #1f1b15;
        --accent: #0f5f8c;
        --accent-strong: #0b4b6f;
        --accent-soft: #deedf6;
        --accent-ink: #ffffff;
        --info-bg: #e8f2f9;
        --info-bg-strong: #cfe6f3;
        --info-ink: #145f8d;
        --info-ink-strong: #0b4b6f;
        --success: #2f8a23;
        --success-ink: #2f8a23;
        --success-bg: #ebf7e8;
        --success-bg-strong: #dff1d9;
        --danger: #ba344f;
        --danger-ink: #a52f47;
        --danger-bg: #fdeff2;
        --danger-bg-soft: #fff2f4;
        --warn-bg: #fff2d8;
        --warn-border: #e0b66a;
        --warn-ink: #6e4e13;
        --warn-bg-soft: #fcf6e7;
        --warn-ink-soft: #7a6128;
        --border: #d5c7ac;
        --border-strong: #c5b494;
        --table-head-bg: #f2e9d9;
        --table-head-ink: #544a3d;
        --progress-track-bg: #e9dfce;
        --progress-track-border: #d7c7ae;
        --progress-accent-start: #0f5f8c;
        --progress-accent-end: #1a78aa;
        --progress-success-start: #2f8a23;
        --progress-success-end: #4cae3f;
        --timeline-connector: #d8c9af;
        --timeline-connector-done: #83b072;
        --placeholder-ink: #8f7f69;
        --input-hover-border: #b99e72;
        --header-bg: rgba(248, 241, 228, 0.9);
        --header-brand: #2c241b;
        --header-brand-hover: #0b4b6f;
        --body-grid-color: rgba(98, 90, 79, 0.045);
        --bg-layer-1: radial-gradient(900px 500px at 6% -10%, rgba(15, 95, 140, 0.09), transparent 56%);
        --bg-layer-2: radial-gradient(1000px 420px at 92% -4%, rgba(217, 72, 15, 0.09), transparent 64%);
        --bg-layer-3: linear-gradient(160deg, #f6f1e7 0%, #f3ecdf 52%, #ede3d2 100%);
        --card-grad-a: rgba(255, 253, 247, 0.98);
        --card-grad-b: rgba(248, 242, 230, 0.98);
        --message-bg: rgba(252, 247, 238, 0.95);
        --message-ink: #5a4f41;
        --ghost-bg: #f4ecde;
        --ghost-ink: #4e4337;
        --button-grad-start: #0f5f8c;
        --button-grad-end: #1a78aa;
        --button-grad-hover-start: #0d547b;
        --button-grad-hover-end: #166a97;
        --button-hover-ink: #ffffff;
        --shadow-container: 0 8px 20px rgba(78, 64, 38, 0.12);
        --shadow-hover-subtle: 0 3px 10px rgba(88, 73, 45, 0.12);
        --focus-ring: rgba(15, 95, 140, 0.28);
        color-scheme: light;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: var(--font-body);
        background: var(--bg-layer-1), var(--bg-layer-2), var(--bg-layer-3);
        color: var(--ink);
        line-height: 1.56;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
          linear-gradient(var(--body-grid-color) 1px, transparent 1px),
          linear-gradient(90deg, var(--body-grid-color) 1px, transparent 1px);
        background-size: 42px 42px;
        opacity: 0.36;
        z-index: 0;
      }

      h1,
      h2,
      h3 {
        font-family: var(--font-display);
        line-height: 1.1;
        letter-spacing: -0.03em;
      }

      a {
        color: var(--accent-strong);
      }

      a:hover {
        color: var(--accent);
      }

      .site-header {
        position: sticky;
        top: 0;
        z-index: 20;
        border-bottom: 1px solid var(--border);
        background: var(--header-bg);
        backdrop-filter: blur(14px);
      }

      .header-inner {
        max-width: 1120px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--space-3);
        padding: var(--space-3) var(--space-4);
      }

      .brand {
        font-family: var(--font-display);
        font-size: clamp(1.45rem, 2.2vw, 1.72rem);
        font-weight: 700;
        color: var(--header-brand);
        text-decoration: none;
      }

      .brand:hover {
        color: var(--header-brand-hover);
      }

      .nav-links {
        display: flex;
        flex: 1;
        min-width: 0;
        gap: var(--space-3);
        align-items: center;
        justify-content: space-between;
      }

      .nav-group {
        display: flex;
        gap: var(--space-2);
        align-items: center;
        flex-wrap: wrap;
      }

      .nav-group-main {
        margin-left: auto;
        justify-content: flex-end;
      }

      .inline-form {
        margin: 0;
        display: inline-flex;
        align-items: center;
      }

      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .nav-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-height: var(--control-min-height);
        border: 1px solid var(--border-strong);
        background: var(--surface);
        color: var(--ink);
        border-radius: var(--radius-nav);
        padding: 0 var(--space-3);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: border-color 160ms ease, background 160ms ease, color 160ms ease;
      }

      .nav-action:hover {
        border-color: color-mix(in srgb, var(--accent) 48%, var(--border-strong));
        background: var(--accent-soft);
        color: var(--accent-strong);
      }

      .nav-action-subject {
        border-radius: var(--radius-pill);
        border-color: color-mix(in srgb, var(--accent) 32%, var(--border-strong));
        background: linear-gradient(
          160deg,
          color-mix(in srgb, var(--accent-soft) 76%, var(--surface)),
          var(--surface-soft)
        );
        color: var(--accent-strong);
        font-weight: 700;
      }

      .nav-action-subject:hover {
        border-color: color-mix(in srgb, var(--accent) 58%, var(--border-strong));
        background: color-mix(in srgb, var(--accent-soft) 92%, var(--surface));
      }

      .nav-action-utility {
        background: var(--surface-soft);
      }

      .nav-text-button {
        border: 0;
        background: transparent;
        color: var(--text-subtle-2);
        font: inherit;
        font-size: 0.9rem;
        font-weight: 600;
        padding: 0;
        cursor: pointer;
      }

      .nav-text-button:hover {
        color: var(--accent-strong);
        text-decoration: underline;
      }

      .mobile-tabbar {
        display: none;
      }

      .mobile-tabbar-inner {
        margin: 0 auto;
        max-width: 920px;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 6px;
        align-items: end;
      }

      .mobile-tab,
      .mobile-tab-button {
        min-height: 58px;
        border-radius: 14px;
        border: 0;
        color: var(--text-subtle);
        text-decoration: none;
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-family: var(--font-body);
        font-size: 0.8rem;
        font-weight: 700;
      }

      .mobile-tab-button {
        width: 100%;
        background: transparent;
        cursor: pointer;
      }

      .mobile-tab svg,
      .mobile-tab-button svg {
        width: 24px;
        height: 24px;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .mobile-tab.is-active,
      .mobile-tab-button.is-active {
        color: var(--accent-strong);
        background: color-mix(in srgb, var(--accent) 16%, transparent);
      }

      .mobile-tab:focus-visible,
      .mobile-tab-button:focus-visible,
      .mobile-subject-link:focus-visible {
        outline: 2px solid color-mix(in srgb, var(--accent) 54%, var(--accent-strong));
        outline-offset: 2px;
      }

      .mobile-tab-subjects {
        position: relative;
      }

      .mobile-subject-list {
        position: absolute;
        right: 0;
        bottom: calc(100% + 10px);
        width: min(280px, calc(100vw - 28px));
        max-height: min(340px, 52vh);
        overflow-y: auto;
        border: 1px solid color-mix(in srgb, var(--border) 88%, transparent);
        border-radius: 16px;
        background: color-mix(in srgb, var(--surface) 95%, var(--surface-soft));
        box-shadow: 0 16px 36px rgba(30, 43, 69, 0.16);
        padding: 8px;
        display: grid;
        gap: 6px;
      }

      .mobile-subject-list[hidden] {
        display: none;
      }

      .mobile-subject-link {
        min-height: 44px;
        border-radius: 11px;
        border: 1px solid color-mix(in srgb, var(--border) 78%, transparent);
        background: color-mix(in srgb, var(--surface) 85%, transparent);
        color: var(--text-subtle-2);
        text-decoration: none;
        display: flex;
        align-items: center;
        padding: 0 12px;
        font-family: var(--font-body);
        font-size: 0.9rem;
        font-weight: 600;
        line-height: 1.2;
      }

      .mobile-subject-link.is-active {
        border-color: color-mix(in srgb, var(--accent) 44%, var(--border));
        color: var(--text-strong);
        background: color-mix(in srgb, var(--accent) 14%, var(--surface));
      }

      .page-shell {
        position: relative;
        z-index: 1;
        max-width: 1120px;
        margin: var(--space-5) auto;
        padding: 0 var(--space-4) var(--space-6);
      }

      .card {
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        background: linear-gradient(160deg, var(--card-grad-a), var(--card-grad-b)), var(--surface);
        box-shadow: var(--shadow-container);
        padding: var(--space-4);
        animation: card-enter 220ms ease-out;
      }

      .messages {
        margin-bottom: var(--space-4);
        display: grid;
        gap: var(--space-2);
      }

      .message {
        border: 1px solid var(--border);
        border-radius: var(--radius-sub);
        padding: var(--space-3);
        background: var(--message-bg);
        color: var(--message-ink);
      }

      .message.error {
        border-color: color-mix(in srgb, var(--danger) 40%, transparent);
        color: var(--danger);
      }

      .message.success {
        border-color: color-mix(in srgb, var(--success) 35%, transparent);
        color: var(--success);
      }

      .btn-primary {
        border: none;
        border-radius: var(--radius-pill);
        background: linear-gradient(145deg, var(--button-grad-start), var(--button-grad-end));
        color: var(--accent-ink);
        min-height: var(--control-min-height);
        padding: 0 var(--space-4);
        font-size: 0.96rem;
        font-weight: 700;
        letter-spacing: 0.01em;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 160ms ease;
      }

      .btn-primary:hover {
        background: linear-gradient(
          145deg,
          var(--button-grad-hover-start),
          var(--button-grad-hover-end)
        );
        color: var(--button-hover-ink);
      }

      .btn-primary:focus-visible,
      .nav-action:focus-visible,
      button:focus-visible,
      input:focus-visible,
      textarea:focus-visible,
      select:focus-visible,
      summary:focus-visible,
      a:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px var(--focus-ring);
      }

      .insecure-banner {
        margin-bottom: var(--space-4);
        border: 1px solid var(--warn-border);
        border-radius: var(--radius-md);
        padding: var(--space-3);
        background: var(--warn-bg);
        color: var(--warn-ink);
        display: flex;
        align-items: flex-start;
        gap: var(--space-2);
      }

      .insecure-banner::before {
        content: "!";
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1.1rem;
        height: 1.1rem;
        margin-top: var(--space-1);
        border-radius: var(--radius-pill);
        border: 1px solid var(--warn-border);
        font-size: 0.78rem;
        font-weight: 700;
        color: var(--warn-ink);
      }

      .muted {
        color: var(--muted);
      }

      .is-hidden {
        display: none;
      }

      .auth-shell {
        max-width: 560px;
        margin: 0 auto;
        padding: var(--space-5) var(--space-5);
      }

      .auth-title {
        margin: 0 0 var(--space-3);
        font-size: clamp(2rem, 6vw, 2.75rem);
      }

      .auth-subtitle {
        margin: 0 0 var(--space-5);
        font-size: 1.02rem;
      }

      .auth-footer {
        margin-top: var(--space-4);
      }

      .form-stack p {
        margin: 0 0 var(--space-4);
      }

      label {
        display: block;
        margin-bottom: var(--space-1);
        color: var(--ink);
        font-size: 0.95rem;
        font-weight: 600;
      }

      input[type="text"],
      input[type="password"],
      input[type="email"],
      input[type="number"],
      textarea,
      select {
        width: 100%;
        max-width: 100%;
        min-height: var(--control-min-height);
        border: 1px solid var(--border-strong);
        border-radius: var(--radius-sub);
        background: var(--surface);
        color: var(--ink);
        font-family: var(--font-body);
        font-size: 0.95rem;
        padding: var(--space-3);
        transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
      }

      input::placeholder,
      textarea::placeholder {
        color: var(--placeholder-ink);
      }

      input:hover,
      textarea:hover,
      select:hover {
        border-color: var(--input-hover-border);
      }

      .errorlist {
        margin: var(--space-2) 0 0;
        padding: 0;
        list-style: none;
        color: var(--danger);
        font-size: 0.85rem;
      }

      .table-wrap {
        overflow-x: auto;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        background: var(--surface);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        text-align: left;
        border-bottom: 1px solid var(--border);
        padding: var(--space-3);
        white-space: nowrap;
      }

      th {
        background: var(--table-head-bg);
        color: var(--table-head-ink);
        font-size: 0.82rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }

      tbody tr:hover {
        background: color-mix(in srgb, var(--accent-soft) 72%, transparent);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      .status-pill {
        display: inline-block;
        border-radius: var(--radius-pill);
        padding: 0 var(--space-2);
        line-height: 1.8;
        font-size: 0.8rem;
        font-weight: 700;
        letter-spacing: 0.02em;
      }

      .status-pill.is-complete {
        background: color-mix(in srgb, var(--success) 13%, transparent);
        color: var(--success-ink);
        border: 1px solid color-mix(in srgb, var(--success) 35%, transparent);
      }

      .status-pill.is-progress {
        background: color-mix(in srgb, var(--accent) 13%, transparent);
        color: var(--accent-strong);
        border: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
      }

      .quiz-shell {
        padding: var(--space-4);
      }

      .quiz-head {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: var(--space-3);
        flex-wrap: wrap;
      }

      .quiz-title {
        margin: 0;
        font-size: clamp(1.5rem, 4vw, 2rem);
      }

      .ghost-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-height: var(--control-min-height);
        border: 1px solid var(--border-strong);
        border-radius: var(--radius-nav);
        padding: 0 var(--space-3);
        text-decoration: none;
        color: var(--ghost-ink);
        background: var(--ghost-bg);
        transition: border-color 160ms ease, color 160ms ease, background 160ms ease;
      }

      .ghost-link:hover {
        border-color: color-mix(in srgb, var(--accent) 45%, transparent);
        color: var(--accent-strong);
        background: var(--accent-soft);
      }

      .quiz-frame-wrap {
        margin-top: var(--space-3);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        overflow: hidden;
        background: var(--surface);
      }

      .quiz-frame {
        width: 100%;
        height: 82vh;
        border: 0;
      }

      @keyframes card-enter {
        from {
          opacity: 0;
          transform: translateY(9px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 980px) {
        .header-inner {
          padding: var(--space-3) var(--space-3);
          flex-wrap: wrap;
          align-items: flex-start;
        }

        .nav-links {
          width: 100%;
          flex-direction: column;
          align-items: flex-start;
          gap: var(--space-2);
        }

        .nav-group {
          width: 100%;
        }

        .nav-group-subjects {
          flex-wrap: nowrap;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: thin;
          padding-bottom: 2px;
        }

        .nav-group-subjects .nav-action {
          flex: 0 0 auto;
        }

        .nav-group-main {
          margin-left: 0;
          justify-content: flex-start;
        }
      }

      @media (max-width: 1180px) {
        body.has-mobile-nav .page-shell {
          padding-bottom: calc(92px + env(safe-area-inset-bottom));
        }

        .mobile-tabbar {
          position: fixed;
          z-index: 35;
          left: 0;
          right: 0;
          bottom: 0;
          border-top: 1px solid color-mix(in srgb, var(--border) 84%, transparent);
          background: color-mix(in srgb, var(--surface) 92%, var(--surface-soft));
          padding:
            10px max(14px, env(safe-area-inset-left))
            calc(10px + env(safe-area-inset-bottom))
            max(14px, env(safe-area-inset-right));
          backdrop-filter: blur(9px);
        }

        body.has-mobile-nav .mobile-tabbar {
          display: block;
        }
      }

      @media (max-width: 640px) {
        .page-shell {
          margin-top: var(--space-4);
          padding-bottom: var(--space-5);
        }

        .brand {
          font-size: 1.36rem;
        }

        .nav-group-subjects {
          flex-wrap: wrap;
          overflow-x: visible;
          padding-bottom: 0;
        }

        .nav-group-main {
          justify-content: flex-start;
        }

        .nav-action {
          padding: 0 var(--space-3);
          font-size: 0.85rem;
        }

        .card {
          border-radius: var(--radius-xl);
          padding: var(--space-4);
        }

        .auth-shell {
          padding: var(--space-4);
        }

        .quiz-frame {
          height: 76vh;
        }
      }

      @media (max-width: 760px) {
        .mobile-tabbar {
          padding:
            8px max(10px, env(safe-area-inset-left))
            calc(8px + env(safe-area-inset-bottom))
            max(10px, env(safe-area-inset-right));
        }

        .mobile-tab,
        .mobile-tab-button {
          min-height: 54px;
          border-radius: 12px;
          font-size: 0.74rem;
        }
      }
    </style>
  </head>
  <body class="{% if request.resolver_match %}page-{{ request.resolver_match.url_name }}{% endif %}{% if request.user.is_authenticated %} has-mobile-nav{% endif %}">
    <header class="site-header">
      <div class="header-inner">
        <a class="brand" href="{% url 'progress' %}">freudd</a>
        <div class="nav-links">
          {% if request.user.is_authenticated and topmenu_enrolled_subjects %}
          <div class="nav-group nav-group-subjects">
            {% for subject in topmenu_enrolled_subjects %}
            <a class="nav-action nav-action-subject" href="{{ subject.detail_url }}">{{ subject.title }}</a>
            {% endfor %}
          </div>
          {% endif %}
          <div class="nav-group nav-group-main">
            {% if leaderboard_default_subject_slug %}
            <a class="nav-action nav-action-utility" href="{% url 'leaderboard-subject' subject_slug=leaderboard_default_subject_slug %}">Quizliga</a>
            {% endif %}
            {% if request.user.is_authenticated %}
            <a class="nav-action nav-action-utility" href="{% url 'progress' %}">Mit overblik</a>
            <form method="post" action="{% url 'logout' %}" class="inline-form">
              {% csrf_token %}
              <button class="nav-text-button" type="submit">Log ud</button>
            </form>
            {% else %}
            <a class="nav-action nav-action-utility" href="{% url 'login' %}">Log ind</a>
            <a class="nav-action nav-action-utility" href="{% url 'signup' %}">Opret konto</a>
            {% endif %}
          </div>
        </div>
      </div>
    </header>
    <main class="page-shell">
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <div class="message {{ message.tags|default:'' }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>
    {% if request.user.is_authenticated %}
    {% with current_page=request.resolver_match.url_name|default:'' current_subject_slug=request.resolver_match.kwargs.subject_slug|default:'' %}
    {% with leaderboard_subject_slug=current_subject_slug|default:leaderboard_default_subject_slug %}
    <nav class="mobile-tabbar" aria-label="PrimÃ¦r navigation" data-mobile-nav>
      <div class="mobile-tabbar-inner">
        {% if leaderboard_subject_slug %}
        <a
          class="mobile-tab {% if current_page == 'leaderboard-subject' or current_page == 'leaderboard-profile' %}is-active{% endif %}"
          href="{% url 'leaderboard-subject' subject_slug=leaderboard_subject_slug %}"
        >
          <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
            <path d="M5 12.6V6.7"></path>
            <path d="M12 12.6V4.6"></path>
            <path d="M19 12.6V8.7"></path>
            <path d="M3.5 18h17"></path>
          </svg>
          <span>Quizliga</span>
        </a>
        {% else %}
        <a class="mobile-tab" href="{% url 'progress' %}">
          <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
            <path d="M5 12.6V6.7"></path>
            <path d="M12 12.6V4.6"></path>
            <path d="M19 12.6V8.7"></path>
            <path d="M3.5 18h17"></path>
          </svg>
          <span>Quizliga</span>
        </a>
        {% endif %}
        <a class="mobile-tab {% if current_page == 'progress' %}is-active{% endif %}" href="{% url 'progress' %}">
          <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
            <path d="M3.8 8.4h16.4"></path>
            <path d="M3.8 15.6h16.4"></path>
            <path d="M8 4.8v14.4"></path>
          </svg>
          <span>Mit overblik</span>
        </a>
        <div class="mobile-tab-subjects">
          <button
            type="button"
            class="mobile-tab-button {% if current_page|slice:':8' == 'subject-' %}is-active{% endif %}"
            data-subject-menu-toggle
            aria-expanded="false"
            aria-controls="mobile-subject-list"
          >
            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
              <path d="M5 5h14"></path>
              <path d="M5 11h14"></path>
              <path d="M5 17h10"></path>
              <path d="m18 15 2 2-2 2"></path>
            </svg>
            <span>Mine fag</span>
          </button>
          <div class="mobile-subject-list" id="mobile-subject-list" data-subject-menu-list hidden>
            {% if topmenu_enrolled_subjects %}
            {% for top_subject in topmenu_enrolled_subjects %}
            <a
              class="mobile-subject-link {% if top_subject.slug == current_subject_slug and current_page|slice:':8' == 'subject-' %}is-active{% endif %}"
              href="{{ top_subject.detail_url }}"
            >
              {{ top_subject.title }}
            </a>
            {% endfor %}
            {% else %}
            <a class="mobile-subject-link" href="{% url 'progress' %}">Ingen tilmeldte fag endnu</a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>
    {% endwith %}
    {% endwith %}
    {% endif %}
    <script>
      (() => {
        const nav = document.querySelector("[data-mobile-nav]");
        if (!nav) {
          return;
        }
        const toggle = nav.querySelector("[data-subject-menu-toggle]");
        const list = nav.querySelector("[data-subject-menu-list]");
        if (!(toggle instanceof HTMLButtonElement) || !(list instanceof HTMLElement)) {
          return;
        }

        const closeList = () => {
          list.setAttribute("hidden", "");
          toggle.setAttribute("aria-expanded", "false");
          toggle.classList.remove("is-active");
        };

        const openList = () => {
          list.removeAttribute("hidden");
          toggle.setAttribute("aria-expanded", "true");
          toggle.classList.add("is-active");
        };

        toggle.addEventListener("click", (event) => {
          event.stopPropagation();
          if (list.hasAttribute("hidden")) {
            openList();
            return;
          }
          closeList();
        });

        document.addEventListener("click", (event) => {
          if (list.hasAttribute("hidden")) {
            return;
          }
          const target = event.target;
          if (target instanceof Node && nav.contains(target)) {
            return;
          }
          closeList();
        });

        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") {
            closeList();
          }
        });

        list.querySelectorAll("a").forEach((item) => {
          item.addEventListener("click", () => {
            closeList();
          });
        });
      })();
    </script>
  </body>
</html>
